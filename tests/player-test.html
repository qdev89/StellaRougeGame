<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stellar Rogue - Player Ship Tests</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            color: #fff;
            font-family: monospace;
        }
        
        #game-container {
            position: relative;
            border: 1px solid #333;
        }
        
        h1 {
            color: #33ff33;
            margin-bottom: 20px;
        }
        
        #test-results {
            margin-top: 20px;
            width: 800px;
            padding: 10px;
            background-color: #111;
            border: 1px solid #333;
            white-space: pre;
            font-family: monospace;
        }
        
        .controls {
            margin-top: 10px;
            color: #aaa;
        }
    </style>
    
    <!-- Phaser library -->
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script>
    
    <!-- Game constants -->
    <script src="../src/js/utils/constants.js"></script>
    
    <!-- Player ship class -->
    <script src="../src/js/entities/player-ship.js"></script>
    
    <script>
        /**
         * Player Ship Test Scene
         * Tests the functionality of the player ship
         */
        class PlayerTestScene extends Phaser.Scene {
            constructor() {
                super({ key: 'PlayerTestScene' });
            }

            preload() {
                // Load test assets
                this.load.image('player-ship', '../src/assets/images/player-ship.png');
                this.load.image('player-ship-engines', '../src/assets/images/player-ship-engines.png');
                this.load.image('laser-blue', '../src/assets/images/laser-blue.png');
                this.load.image('plasma-bolt', '../src/assets/images/plasma-bolt.png');
                this.load.image('missile', '../src/assets/images/missile.png');
                this.load.image('star-particle', '../src/assets/images/star-particle.png');
            }

            create() {
                console.log('PlayerTestScene: Starting player ship tests...');
                
                // Create a simple background
                this.add.rectangle(0, 0, 800, 600, 0x000022).setOrigin(0);
                
                // Add some stars
                for (let i = 0; i < 50; i++) {
                    const x = Phaser.Math.Between(0, 800);
                    const y = Phaser.Math.Between(0, 600);
                    const size = Phaser.Math.Between(1, 3);
                    
                    this.add.circle(x, y, size, 0xffffff, 0.7);
                }
                
                // Create player ship
                this.player = new PlayerShip(this, 400, 500, 'player-ship');
                
                // Add UI for test controls
                this.createTestUI();
                
                // Set up keyboard controls
                this.cursors = this.input.keyboard.createCursorKeys();
                this.keys = this.input.keyboard.addKeys({
                    w: Phaser.Input.Keyboard.KeyCodes.W,
                    a: Phaser.Input.Keyboard.KeyCodes.A,
                    s: Phaser.Input.Keyboard.KeyCodes.S,
                    d: Phaser.Input.Keyboard.KeyCodes.D,
                    space: Phaser.Input.Keyboard.KeyCodes.SPACE,
                    shift: Phaser.Input.Keyboard.KeyCodes.SHIFT
                });
                
                // Test results container
                this.testResults = {
                    movement: false,
                    firing: false,
                    dash: false,
                    damage: false,
                    healing: false
                };
                
                // Create test targets
                this.createTestTargets();
            }
            
            createTestUI() {
                // Add test instructions
                this.add.text(400, 30, 'PLAYER SHIP TEST SCENE', {
                    fontFamily: 'monospace',
                    fontSize: '24px',
                    color: '#ffffff'
                }).setOrigin(0.5);
                
                this.add.text(400, 60, 'Use WASD/Arrows to move, SPACE to fire, SHIFT to dash', {
                    fontFamily: 'monospace',
                    fontSize: '16px',
                    color: '#cccccc'
                }).setOrigin(0.5);
                
                // Add test result display
                this.resultText = this.add.text(20, 100, 'Running tests...', {
                    fontFamily: 'monospace',
                    fontSize: '14px',
                    color: '#33ff33'
                });
                
                // Add weapon selector
                const weapons = ['BASIC_LASER', 'SPREAD_SHOT', 'PLASMA_BOLT', 'HOMING_MISSILE'];
                
                weapons.forEach((weapon, index) => {
                    const button = this.add.rectangle(100 + index * 150, 550, 120, 30, 0x333333)
                        .setInteractive()
                        .setOrigin(0.5);
                        
                    this.add.text(100 + index * 150, 550, weapon, {
                        fontFamily: 'monospace',
                        fontSize: '12px',
                        color: '#ffffff'
                    }).setOrigin(0.5);
                    
                    button.on('pointerdown', () => {
                        this.player.weaponType = weapon;
                        console.log(`Switched to weapon: ${weapon}`);
                    });
                });
                
                // Add test buttons
                const testDamageButton = this.add.rectangle(700, 500, 160, 30, 0x333333)
                    .setInteractive()
                    .setOrigin(0.5);
                    
                this.add.text(700, 500, 'TEST DAMAGE', {
                    fontFamily: 'monospace',
                    fontSize: '14px',
                    color: '#ffffff'
                }).setOrigin(0.5);
                
                testDamageButton.on('pointerdown', () => {
                    this.testDamage();
                });
                
                const testHealButton = this.add.rectangle(700, 550, 160, 30, 0x333333)
                    .setInteractive()
                    .setOrigin(0.5);
                    
                this.add.text(700, 550, 'TEST HEALING', {
                    fontFamily: 'monospace',
                    fontSize: '14px',
                    color: '#ffffff'
                }).setOrigin(0.5);
                
                testHealButton.on('pointerdown', () => {
                    this.testHealing();
                });
            }
            
            createTestTargets() {
                // Create some targets for the player to shoot at
                this.targets = this.physics.add.group();
                
                for (let i = 0; i < 5; i++) {
                    const target = this.physics.add.sprite(100 + i * 150, 200, 'star-particle')
                        .setScale(3)
                        .setTint(0xff0000);
                        
                    this.targets.add(target);
                }
                
                // Set up collision between player projectiles and targets
                this.physics.add.collider(
                    this.player.projectiles,
                    this.targets,
                    (projectile, target) => {
                        projectile.destroy();
                        target.setTint(0x00ff00);
                        this.testResults.firing = true;
                    }
                );
            }
            
            testDamage() {
                // Apply damage to the player
                const damageAmount = 20;
                console.log(`Testing damage: ${damageAmount} points`);
                
                const result = this.player.takeDamage(damageAmount);
                this.testResults.damage = true;
                
                console.log(`Player health: ${this.player.health}/${this.player.maxHealth}`);
                console.log(`Player shields: ${this.player.shields}/${this.player.maxShields}`);
            }
            
            testHealing() {
                // Heal the player
                const healAmount = 15;
                console.log(`Testing healing: ${healAmount} points`);
                
                this.player.heal(healAmount);
                this.player.rechargeShields(healAmount);
                this.testResults.healing = true;
                
                console.log(`Player health: ${this.player.health}/${this.player.maxHealth}`);
                console.log(`Player shields: ${this.player.shields}/${this.player.maxShields}`);
            }
            
            update() {
                // Update player
                if (this.player && this.player.active) {
                    this.player.update();
                    
                    // Check for movement
                    if (this.player.body.velocity.x !== 0 || this.player.body.velocity.y !== 0) {
                        this.testResults.movement = true;
                    }
                    
                    // Check for dash
                    if (this.player.isDashing) {
                        this.testResults.dash = true;
                    }
                }
                
                // Update test results display
                this.updateResultsDisplay();
            }
            
            updateResultsDisplay() {
                let resultText = 'TEST RESULTS:\n\n';
                
                // Format test results
                resultText += `Movement: ${this.formatTestResult(this.testResults.movement)}\n`;
                resultText += `Firing: ${this.formatTestResult(this.testResults.firing)}\n`;
                resultText += `Dash: ${this.formatTestResult(this.testResults.dash)}\n`;
                resultText += `Damage: ${this.formatTestResult(this.testResults.damage)}\n`;
                resultText += `Healing: ${this.formatTestResult(this.testResults.healing)}\n\n`;
                
                // Add player stats
                resultText += `Health: ${this.player.health}/${this.player.maxHealth}\n`;
                resultText += `Shields: ${this.player.shields}/${this.player.maxShields}\n`;
                resultText += `Weapon: ${this.player.weaponType}\n`;
                
                this.resultText.setText(resultText);
            }
            
            formatTestResult(result) {
                return result ? '✓ PASS' : '✗ FAIL';
            }
        }

        // Create test config
        const testConfig = {
            type: Phaser.AUTO,
            width: 800,
            height: 600,
            backgroundColor: '#000000',
            parent: 'game-container',
            physics: {
                default: 'arcade',
                arcade: {
                    gravity: { y: 0 },
                    debug: false
                }
            },
            scene: [PlayerTestScene]
        };

        // Create test game instance when this script is loaded
        document.addEventListener('DOMContentLoaded', () => {
            const game = new Phaser.Game(testConfig);
            console.log('Player ship test initialized');
        });
    </script>
</head>
<body>
    <h1>STELLAR ROGUE - PLAYER SHIP TESTS</h1>
    <div id="game-container"></div>
    <div class="controls">Use WASD/Arrow keys to move, SPACE to fire, SHIFT to dash</div>
    <div id="test-results">Test results will appear here...</div>
    
    <script>
        // Capture console output to display in the test results div
        const testResults = document.getElementById('test-results');
        const originalConsoleLog = console.log;
        const originalConsoleWarn = console.warn;
        const originalConsoleError = console.error;
        
        console.log = function() {
            originalConsoleLog.apply(console, arguments);
            const args = Array.from(arguments);
            testResults.textContent += '> ' + args.join(' ') + '\n';
        };
        
        console.warn = function() {
            originalConsoleWarn.apply(console, arguments);
            const args = Array.from(arguments);
            testResults.textContent += '⚠️ ' + args.join(' ') + '\n';
        };
        
        console.error = function() {
            originalConsoleError.apply(console, arguments);
            const args = Array.from(arguments);
            testResults.textContent += '❌ ' + args.join(' ') + '\n';
        };
    </script>
</body>
</html>
